package prodcons.v5;

import java.util.ArrayList;
import java.util.Properties;

public class TestProdCons {

    public static void main(String[] args) throws Exception {

    	Properties properties = new Properties();
    	properties.loadFromXML(TestProdCons.class.getResourceAsStream("options.xml"));

        int nProd = Integer.parseInt(properties.getProperty("nProd"));
        int nCons = Integer.parseInt(properties.getProperty("nCons"));
        int bufSz = Integer.parseInt(properties.getProperty("bufSz"));
        int prodTime = Integer.parseInt(properties.getProperty("prodTime"));
        int consTime = Integer.parseInt(properties.getProperty("consTime"));
        int minProd = Integer.parseInt(properties.getProperty("minProd"));
        int maxProd = Integer.parseInt(properties.getProperty("maxProd"));

        IProdConsBuffer buffer = new ProdConsBuffer(bufSz,nProd);

        System.out.println("EXECUTION : V1 (Obj1)");
        
        // producers
        for (int i = 0; i < nProd; i++) {	
        	new Producer(buffer, minProd, maxProd, prodTime).start(); 
              
        }

        // consumers
        for (int i = 0; i < nCons; i++) {
        	new Consumer(buffer, consTime).start();
            
        }
        
        // TEST : Tous les messages produits sont consommés
        Thread.sleep(3000);
        System.out.println("TEST : Produced = " + buffer.totmsg());
        System.out.println("TEST : Consumed = " + Consumer.getTotmsgC());


        
     // TEST : Lancement mélanger (la concurrence)
     /*
     ArrayList<Thread> threads = new ArrayList<>();

     for (int i = 0; i < nProd; i++) {
         threads.add(new Producer(buffer, minProd, maxProd, prodTime));
     }

 
     for (int i = 0; i < nCons; i++) {
         threads.add(new Consumer(buffer, consTime));
     }

  
     java.util.Collections.shuffle(threads);

 
     for (Thread t : threads) {
         t.start();
         Thread.sleep(5); 
     }
    
    */
    }
}